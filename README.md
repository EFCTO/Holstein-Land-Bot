# Holstein-Land-Bot
## 1. 프로젝트 개요

프로젝트명: 홀슈타인 란드 통합 봇
의도:
* 기존에 분산되어 있던 다수의 디스코드 봇 기능(음악, 관리, 유틸리티, 로그, 게임 등)을 하나의 통합 봇으로 집약.
* 사용자 경험을 단일화하고 유지보수 효율을 극대화.
* 중장기적으로 확장 가능한 모듈식 구조를 도입하여 기능 추가 및 업데이트 용이.

## 2. 주요 구현할 기능 목록

**1. 음악봇 기능**
-현재 eara, 하리보, 알로항으로 나누어져 있는 음악 봇을 하나로 통합
**2. 방송알림 기능**
-유튜브 알림, 치지직 방송 알림 등을 출력하는 기능
**3. 서버 상태 관련 기능**
-ServerStats, Statbot과 같은 상태 관련 기능 구현
**4. 관리기능**
-미육이, Zira와 같은 관리, 보안, 유틸 기능 구현

## 3. 개발 환경
* 프로그래밍 언어: JavaScript (Node.js LTS)
* 디스코드 라이브러리: Discord.js v14
* 형상 관리: GitHub
* 데이터 구조 :
  * MySQL (주력) > 유저 데이터, 로그 기록 등 영속적 저장
  * Redis (보조)  > 실시간 캐싱 (쿨다운, 랭킹, 세션 관리 등)
  * JSON (단기) > 임시 데이터 저장, 파일 캐시, 환경 설정 등등

## 4. 아키텍처 구성

| 계층 | 설명 |
| --- | --- |
| `src/core` | Discord 클라이언트 초기화와 명령어/인터랙션/이벤트 로더를 담당하는 BotClient 구현체 및 공통 로더. |
| `src/events` | `ready`, `interactionCreate` 등 Discord 이벤트 핸들러 모음. |
| `src/commands` | Slash 명령어 모듈. 각 명령은 도메인 서비스에 의존하며 UI 요소는 최소화. |
| `src/interactions` | 버튼/모달/셀렉트 메뉴 등 컴포넌트별 핸들러. 명령과 분리하여 재사용과 테스트 용이. |
| `src/modules/party` | 파티 도메인 로직(엔티티, 리포지토리, 서비스, 임베드, 라이프사이클, 헬퍼) 캡슐화. |
| `src/services` | 애플리케이션 전역에서 재사용되는 서비스 인스턴스 초기화·종료. |

### 서비스 주입 구조
* `BotClient.registerService(name, instance)`로 서비스 등록 후, `interaction.client.getService(name)`을 통해 어디서든 접근 가능.
* 상호작용 핸들러는 `ensurePartyService` 헬퍼를 사용해 서비스 초기화 여부를 확인하고, 미준비 시 사용자에게 안내 메시지를 보냅니다.

## 5. 파티 시스템 흐름

1. 사용자가 `/coh3_create`, `/hoi4_create` 명령을 실행하면 `PartyService`가 초안(draft)을 생성하고 설정용 컴포넌트와 모달을 제공합니다.
2. 버튼/모달/셀렉트 인터랙션 핸들러가 초안을 갱신하며, "생성" 버튼을 누르면 Discord 메시지를 발행하고 초안을 실제 파티로 승격합니다.
3. 파티 데이터는 `PartyRepository`를 통해 JSON 파일에 지속 저장되어 재시작 시 복구 가능합니다.
4. `PartyService`의 만료 스케줄러가 24시간이 지난 파티를 감지하고 `closeParty` 라이프사이클 함수를 호출해 메시지를 정리 및 알림을 전송합니다.
5. 클라이언트 종료 시 `shutdownServices`가 호출되어 만료 스케줄러 등 백그라운드 작업을 안전하게 정리합니다.

## 6. 개발/배포 메모

* `DISCORD_TOKEN` 등 환경 변수는 `.env`로 관리합니다.
* 명령/인터랙션을 추가할 경우 해당 디렉터리에 JS 파일을 추가하면 BotClient가 자동으로 로드합니다.
* JSON 저장소(`data/parties.json`)는 활성 파티만 저장하며, 종료 시 자동 정리됩니다.
* 프로세스 종료 시(`SIGINT`, `SIGTERM`) 등록된 서비스가 먼저 정리되고 Discord 클라이언트가 종료되도록 `registerShutdownHandlers`가 구성되어 있습니다.

## 7.기여 
https://discord.gg/8Vnz49nJ 해당 디스코드에 참여 후 PR을 보내주세요 

